<div class="chat-container">
  <!-- Header -->
  <header class="chat-header">
    <div class="header-content">
      <div class="logo-section">
        <div class="logo-icon">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z" fill="currentColor"/>
            <path d="M12 6C8.69 6 6 8.69 6 12C6 15.31 8.69 18 12 18C15.31 18 18 15.31 18 12C18 8.69 15.31 6 12 6ZM12 16C9.79 16 8 14.21 8 12C8 9.79 9.79 8 12 8C14.21 8 16 9.79 16 12C16 14.21 14.21 16 12 16Z" fill="currentColor"/>
            <circle cx="12" cy="12" r="3" fill="currentColor"/>
          </svg>
        </div>
        <div class="logo-text">
          <h1>AI Chat Assistant</h1>
          <span class="subtitle">Multi-Agent Intelligence</span>
        </div>
      </div>
      <div class="header-actions">
        <div class="connection-status" [class.connected]="isConnected" [class.disconnected]="!isConnected">
          <span class="status-dot"></span>
          <span class="status-text">{{ isConnected ? 'Connected' : 'Disconnected' }}</span>
        </div>
        <button class="btn-icon" (click)="clearChat()" title="Clear conversation" [disabled]="messages.length === 0">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Connection Error Banner -->
  @if (connectionError) {
    <div class="error-banner">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
        <path d="M12 8V12M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <span>{{ connectionError }}</span>
      <button class="retry-btn" (click)="checkConnection()">Retry</button>
    </div>
  }

  <!-- Messages Area -->
  <main class="messages-area" #messagesContainer>
    @if (messages.length === 0) {
      <div class="welcome-screen">
        <div class="welcome-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <h2>Welcome to AI Chat Assistant</h2>
        <p>I'm powered by multiple specialized agents ready to help you with:</p>
        <div class="agent-cards">
          <div class="agent-card">
            <span class="agent-icon">ðŸ’¬</span>
            <h3>General Chat</h3>
            <p>Casual conversations, recommendations, and general knowledge</p>
          </div>
          <div class="agent-card">
            <span class="agent-icon">ðŸ’»</span>
            <h3>Technical Expert</h3>
            <p>Programming, debugging, and software development</p>
          </div>
          <div class="agent-card">
            <span class="agent-icon">ðŸ“š</span>
            <h3>Student Helper</h3>
            <p>Learning, homework help, and educational guidance</p>
          </div>
        </div>
        <p class="hint">Start typing to begin a conversation...</p>
      </div>
    } @else {
      <div class="messages-list">
        @for (message of messages; track message.id) {
          <div class="message" [class.user]="message.role === 'user'" [class.assistant]="message.role === 'assistant'">
            @if (message.role === 'assistant') {
              <div class="avatar assistant-avatar">
                <span>{{ getAgentIcon(message.agentUsed) }}</span>
              </div>
            }
            <div class="message-content">
              @if (message.role === 'assistant' && message.agentUsed) {
                <div class="agent-badge">
                  {{ getAgentLabel(message.agentUsed) }}
                </div>
              }
              @if (message.isLoading && !message.content) {
                <div class="typing-indicator">
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
              } @else {
                <div class="message-text markdown-content"
                     [class.streaming]="message.isLoading && message.content"
                     [innerHTML]="message.content | markdown">
                </div>
                @if (message.isLoading && message.content) {
                  <span class="streaming-cursor"></span>
                }
              }
              <div class="message-time">{{ formatTime(message.timestamp) }}</div>
            </div>
            @if (message.role === 'user') {
              <div class="avatar user-avatar">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
            }
          </div>
        }
      </div>
    }
  </main>

  <!-- Input Area -->
  <footer class="input-area">
    <div class="input-container">
      <textarea
        #messageInput
        [(ngModel)]="newMessage"
        (keydown)="handleKeydown($event)"
        placeholder="Type your message..."
        rows="1"
        [disabled]="isLoading || !isConnected"
        class="message-input"
      ></textarea>
      <button
        class="send-button"
        (click)="sendMessage()"
        [disabled]="!newMessage.trim() || isLoading || !isConnected"
        [class.loading]="isLoading"
      >
        @if (isLoading) {
          <div class="spinner"></div>
        } @else {
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        }
      </button>
    </div>
    <p class="input-hint">Press Enter to send, Shift+Enter for new line</p>
  </footer>
</div>
